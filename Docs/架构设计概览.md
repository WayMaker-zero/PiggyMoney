# 架构设计概览（简洁版）

目标：提供一个可本地运行、移动/桌面自适配、可扩展的数据驱动记账应用。以 TypeScript + 端口/适配器架构解耦实现细节，支持 IndexedDB、SQLite(WASM) 与 JSON 备份/迁移。

## 技术栈
- TypeScript + 原生 HTML/CSS/JS（可渐进使用任意 UI 库）。
- 图表：Chart.js 或 ECharts（通过 `ChartProvider` 封装）。
- 存储：IndexedDB（默认）、SQLite WASM（文件账本）、JSON（导入/导出）。

## 分层结构
- UI 层：页面/组件、路由与响应式布局。
- 应用层（Use Cases）：编排流程、校验与错误处理，仅依赖端口接口。
- 领域层（Domain）：实体/值对象与领域规则（金额、类型、日期、余额计算）。
- 基础设施层（Adapters）：各存储/图表/加密等实现与系统集成。

## 关键端口（接口名称）
- 数据：`IDataStore`（统一数据访问）。
- 统计：`IAnalyticsService`（周/月聚合、余额/收支序列）。
- 图表：`IChartProvider`（折线渲染/释放）。
- 备份：`IBackupService`（JSON/SQLite 导入导出 + 可选加密）。
- 加密：`ICryptoProvider`（WebCrypto 包装）。
- NLP：`INlpParser`（占位，后续接入）。

## 存储与迁移
- 模式：
  - IndexedDB：移动端首选，自动持久化。
  - SQLite(WASM)：文件账本（.sqlite），桌面增强。
  - JSON：通用备份/迁移格式，支持加密。
- 切换：设置页选择模式；`StorageRouter` 基于能力检测与用户选择装配适配器。
- 迁移：`IDB ↔ JSON ↔ SQLite`，默认全量覆盖（可选合并策略）。

## 数据模型（精简）
- User：`{ id, username, passwordHash?, createdAt }`
- Ledger：`{ userId, initialBalance, createdAt }`
- Transaction：`{ id, userId, amount, type, date, note?, tags? }`
- Snapshot（可选）：`{ date, balance }`（性能优化用）。

## 目录建议
```
/src
  /app        # 入口、路由、全局状态
  /ui         # 视图组件
  /domain     # 实体与规则
  /usecases   # 用例服务
  /ports      # 接口定义
  /adapters   # idb/sqlite/json/chart/crypto 实现
  /utils      # 日期/金额/校验/uuid
  /config     # 运行时配置
```

## 里程碑（高层）
1) IndexedDB MVP：登录/初始化余额/记账 CRUD/周月图表 + JSON 导出。
2) 备份/迁移：JSON 导入（合并/覆盖）+ 可选加密。
3) SQLite 文件账本：选择/保存 .sqlite + 与 JSON 互导。
4) 体验增强：标签/搜索/PWA；NLP 记账接口对接。

## 响应式说明
CSS 响应式为主（断点：480/768/1024/1440），脚本增强 `--vh` 与图表 DPR；详见 `Docs/移动端与PC端自动适配方案.md`。

